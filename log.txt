
> opencollective-api@2.0.494 test /home/CIT/leonardom/projects/leonardo/opencollective/api
> TZ=UTC nyc mocha --reporter-options mochaFile=$(bash scripts/test_output_dir.sh junit)/junit.xml

[33mwarn[39m: Missing clearbit config: key (CLEARBIT_KEY)


  authlib
    âœ“ should generate valid tokens
    âœ“ should validate tokens
    âœ“ should prevent changing the algorithm for validate

  clearbit
    âœ“ catches the NotFound error

  Collective model
----------------------------------------|----------|----------|----------|----------|-------------------|
File                                    |  % Stmts | % Branch |  % Funcs |  % Lines | Uncovered Line #s |
----------------------------------------|----------|----------|----------|----------|-------------------|
All files                               |     20.5 |     1.85 |    11.13 |    21.25 |                   |
 scripts                                |     5.92 |     1.08 |        0 |     6.27 |                   |
  db_restore.js                         |    17.39 |    11.11 |        0 |    18.18 |... 42,46,52,58,62 |
  ledger_fixer.js                       |     4.98 |     0.56 |        0 |     5.28 |... 55,656,657,659 |
 server                                 |     72.5 |    41.18 |    42.86 |    72.96 |                   |
  background-jobs.js                    |      100 |       50 |      100 |      100 |                64 |
  env.js                                |    66.67 |       50 |      100 |    66.67 |     6,14,17,20,26 |
  index.js                              |       90 |       50 |      100 |       90 |             34,35 |
  routes.js                             |    66.96 |    33.33 |    11.11 |    67.57 |... 44,145,146,164 |
 server/constants                       |      100 |      100 |      100 |      100 |                   |
  activities.js                         |      100 |      100 |      100 |      100 |                   |
  channels.js                           |      100 |      100 |      100 |      100 |                   |
  collectives.js                        |      100 |      100 |      100 |      100 |                   |
  currency_format.js                    |      100 |      100 |      100 |      100 |                   |
  expense_status.js                     |      100 |      100 |      100 |      100 |                   |
  expense_type.js                       |      100 |      100 |      100 |      100 |                   |
  index.js                              |      100 |      100 |      100 |      100 |                   |
  intervals.js                          |      100 |      100 |      100 |      100 |                   |
  math.js                               |      100 |      100 |      100 |      100 |                   |
  order_status.js                       |      100 |      100 |      100 |      100 |                   |
  transactions.js                       |      100 |      100 |      100 |      100 |                   |
  vat.js                                |      100 |      100 |      100 |      100 |                   |
 server/controllers                     |    24.92 |     0.72 |    10.98 |    25.08 |                   |
  connectedAccounts.js                  |    13.91 |        0 |    13.89 |    14.04 |... 42,243,244,245 |
  helloworks.js                         |    28.07 |        0 |        0 |    28.07 |... ,96,98,106,110 |
  homepage.js                           |    62.16 |       25 |    28.57 |    63.89 |... 64,73,85,88,89 |
  images.js                             |       25 |        0 |        0 |       25 |... 61,62,63,65,66 |
  paymentMethods.js                     |    22.22 |        0 |        0 |    22.22 |... 99,110,111,113 |
  test.js                               |    15.69 |        0 |        0 |    15.69 |... 50,151,152,154 |
  users.js                              |    32.14 |        0 |    18.18 |    32.14 |... 50,52,54,64,65 |
  webhooks.js                           |    33.33 |      100 |        0 |    33.33 |               4,6 |
 server/controllers/services            |    10.45 |        0 |        0 |    11.02 |                   |
  email.js                              |    10.45 |        0 |        0 |    11.02 |... 09,316,323,324 |
 server/graphql                         |    10.55 |        0 |        0 |    10.82 |                   |
  errors.js                             |      100 |      100 |      100 |      100 |                   |
  loaders.js                            |     7.29 |        0 |        0 |     7.49 |... 15,616,625,626 |
 server/graphql/v1                      |    16.94 |        0 |    11.73 |    17.81 |                   |
  Application.js                        |    33.33 |        0 |       20 |    33.33 |... 60,67,68,75,76 |
  CollectiveInterface.js                |    11.87 |        0 |     8.11 |    12.54 |... 1710,1711,1712 |
  TransactionInterface.js               |     18.1 |        0 |    12.77 |    18.81 |... 49,357,365,373 |
  inputTypes.js                         |    85.19 |        0 |    86.96 |    85.19 |... 28,32,33,34,37 |
  mutations.js                          |    25.95 |        0 |     9.72 |    26.56 |... 74,891,904,920 |
  queries.js                            |      4.5 |        0 |      2.5 |     4.97 |... 1408,1420,1421 |
  schema.js                             |      100 |      100 |      100 |      100 |                   |
  types.js                              |    17.87 |        0 |     9.23 |    18.27 |... 2115,2121,2127 |
  utils.js                              |    33.33 |        0 |    16.67 |    33.33 |... 25,26,27,30,31 |
 server/graphql/v1/mutations            |     7.61 |        0 |     1.29 |      7.7 |                   |
  applications.js                       |    16.67 |        0 |        0 |    17.39 |... 50,51,54,55,58 |
  backyourstack.js                      |    23.53 |        0 |        0 |    23.53 |... 22,23,24,29,30 |
  collectives.js                        |     4.82 |        0 |        0 |     4.86 |... 1034,1036,1050 |
  comments.js                           |    15.38 |        0 |        0 |    16.67 |... 50,51,52,56,57 |
  connectedAccounts.js                  |     12.5 |        0 |        0 |     12.5 |... 44,47,48,51,52 |
  expenses.js                           |     7.36 |        0 |        0 |     7.41 |... 88,389,395,397 |
  members.js                            |     8.89 |        0 |        0 |     8.89 |... 16,117,124,125 |
  notifications.js                      |       16 |        0 |        0 |       16 |... 25,126,129,130 |
  orders.js                             |     4.98 |        0 |        0 |     5.03 |... 1061,1063,1066 |
  paymentMethods.js                     |    11.29 |        0 |        0 |    11.29 |... 91,192,193,196 |
  tiers.js                              |     5.88 |        0 |        0 |     6.25 |... 30,33,34,35,38 |
  updates.js                            |     11.9 |        0 |        0 |     12.5 |... 73,74,75,76,77 |
  users.js                              |    26.47 |        0 |    33.33 |    26.47 |... 67,70,72,73,76 |
 server/graphql/v2                      |    74.36 |       25 |       25 |    74.36 |                   |
  identifiers.js                        |       50 |       25 |        0 |       50 |... 21,25,26,27,31 |
  schema.js                             |      100 |      100 |      100 |      100 |                   |
  types.js                              |      100 |      100 |      100 |      100 |                   |
 server/graphql/v2/collection           |    51.85 |      100 |       25 |    51.85 |                   |
  MemberCollection.js                   |       50 |      100 |       25 |       50 | 13,19,25,31,46,52 |
  OrderCollection.js                    |       50 |      100 |       20 |       50 |       13,19,25,31 |
  TransactionCollection.js              |    57.14 |      100 |    33.33 |    57.14 |          13,19,20 |
 server/graphql/v2/enum                 |      100 |      100 |      100 |      100 |                   |
  AccountOrdersFilter.js                |      100 |      100 |      100 |      100 |                   |
  AccountType.js                        |      100 |      100 |      100 |      100 |                   |
  Currency.js                           |      100 |      100 |      100 |      100 |                   |
  DateTimeField.js                      |      100 |      100 |      100 |      100 |                   |
  ImageFormat.js                        |      100 |      100 |      100 |      100 |                   |
  MemberRole.js                         |      100 |      100 |      100 |      100 |                   |
  OrderDirectionType.js                 |      100 |      100 |      100 |      100 |                   |
  OrderFrequency.js                     |      100 |      100 |      100 |      100 |                   |
  OrderStatus.js                        |      100 |      100 |      100 |      100 |                   |
  TransactionType.js                    |      100 |      100 |      100 |      100 |                   |
  index.js                              |      100 |      100 |      100 |      100 |                   |
 server/graphql/v2/input                |      100 |      100 |      100 |      100 |                   |
  ChronologicalOrder.js                 |      100 |      100 |      100 |      100 |                   |
 server/graphql/v2/interface            |    37.74 |        0 |     8.82 |    37.74 |                   |
  Account.js                            |    32.73 |        0 |     6.25 |    32.73 |... 67,179,185,191 |
  HasMembers.js                         |     37.5 |        0 |        0 |     37.5 |... 26,27,28,32,45 |
  IsMemberOf.js                         |    42.86 |        0 |        0 |    42.86 |... 24,25,26,27,30 |
  Transaction.js                        |    47.62 |        0 |    15.38 |    47.62 |... 32,141,147,154 |
 server/graphql/v2/object               |    48.61 |        0 |    27.54 |     49.3 |                   |
  Amount.js                             |    66.67 |      100 |    33.33 |    66.67 |             13,19 |
  Bot.js                                |    83.33 |      100 |    66.67 |    83.33 |                 9 |
  Collective.js                         |    83.33 |      100 |    66.67 |    83.33 |                 9 |
  Credit.js                             |    66.67 |      100 |       40 |    66.67 |          10,17,23 |
  Debit.js                              |    66.67 |      100 |       40 |    66.67 |          10,17,23 |
  Event.js                              |    83.33 |      100 |    66.67 |    83.33 |                 9 |
  Individual.js                         |       40 |        0 |    22.22 |    42.86 |... 24,25,32,33,34 |
  Member.js                             |    42.86 |        0 |    16.67 |    42.86 |... 6,68,72,86,102 |
  Order.js                              |    28.13 |        0 |     7.14 |    28.13 |... 95,101,102,106 |
  Organization.js                       |       50 |        0 |       40 |    55.56 |        9,16,17,18 |
  Tier.js                               |    41.18 |        0 |    14.29 |    41.18 |... 54,56,57,62,64 |
 server/graphql/v2/query                |    37.74 |        0 |        0 |    37.74 |                   |
  AccountQuery.js                       |    30.43 |        0 |        0 |    30.43 |... 38,41,43,44,46 |
  CollectiveQuery.js                    |    30.43 |        0 |        0 |    30.43 |... 38,41,43,44,46 |
  index.js                              |    85.71 |      100 |        0 |    85.71 |                19 |
 server/lib                             |    20.73 |     5.18 |    11.52 |    21.44 |                   |
  activities.js                         |     4.29 |        0 |        0 |     4.29 |... 33,336,337,339 |
  algolia.js                            |    16.67 |        0 |        0 |    16.67 |... 27,28,29,31,37 |
  auth.js                               |    54.84 |     7.14 |       40 |    57.69 |... 60,61,68,69,70 |
  awsS3.js                              |       80 |       50 |      100 |       80 |                 7 |
  clearbit.js                           |      100 |       50 |      100 |      100 |                 8 |
  cloudflare.js                         |    35.71 |    34.78 |        0 |    37.04 |... 50,53,55,56,59 |
  collectivelib.js                      |    21.88 |        0 |        0 |    21.88 |... 6,67,71,72,138 |
  currency.js                           |       50 |    43.24 |    35.71 |    58.18 |... ,78,90,100,102 |
  data.js                               |    15.38 |        0 |        0 |    18.18 |... 43,44,47,48,53 |
  db.js                                 |    31.91 |    33.33 |    22.22 |    32.61 |... 58,162,163,164 |
  email.js                              |    13.64 |        0 |    11.11 |    13.95 |... 39,340,341,342 |
  emailTemplates.js                     |      100 |      100 |      100 |      100 |                   |
  encryption.js                         |    30.43 |        0 |        0 |    33.33 |... 25,27,29,30,33 |
  errors.js                             |    10.34 |        0 |     7.69 |    10.53 |... 8,95,96,97,100 |
  express.js                            |    60.27 |    44.44 |    16.67 |    61.11 |... 10,115,126,127 |
  forest.js                             |     4.96 |     6.67 |     1.67 |      5.3 |... 23,324,325,327 |
  github.js                             |    10.17 |        0 |        0 |    10.34 |... 40,143,147,150 |
  handlebars.js                         |    22.73 |        0 |        0 |    26.32 |... 18,119,121,132 |
  hostlib.js                            |     6.52 |        0 |        0 |     7.14 |... 33,137,138,140 |
  logger.js                             |      100 |      100 |      100 |      100 |                   |
  math.js                               |        0 |        0 |        0 |        0 |              3,11 |
  notifications.js                      |     8.39 |        0 |        0 |      8.5 |... 32,335,336,339 |
  onboarding.js                         |    17.14 |        0 |        0 |    18.18 |... 57,59,60,62,65 |
  payments.js                           |    16.31 |        0 |    17.39 |    16.43 |... 18,419,421,424 |
  queries.js                            |    40.39 |    13.19 |    44.07 |     40.1 |... 14,920,921,922 |
  recaptcha.js                          |    42.11 |      100 |        0 |    42.11 |... 19,20,21,22,24 |
  search.js                             |    24.49 |        0 |       25 |    25.53 |... 64,167,168,169 |
  slack.js                              |    22.86 |        0 |        0 |    22.86 |... 75,77,84,85,93 |
  stripe.js                             |    35.71 |        0 |        0 |    35.71 |... 17,18,20,23,31 |
  subscriptions.js                      |     9.09 |        0 |        0 |     9.09 |... 36,337,360,361 |
  tax-forms.js                          |    15.38 |        0 |        0 |    15.38 |... 07,109,112,113 |
  transactions.js                       |     9.84 |        0 |        0 |    10.91 |... 90,191,192,193 |
  twitter.js                            |    21.79 |        0 |       25 |    21.79 |... 65,167,168,171 |
  userlib.js                            |    19.35 |        0 |        0 |    19.35 |... 55,56,57,62,64 |
  utils.js                              |     8.33 |        0 |        0 |     9.34 |... 68,569,570,574 |
  validators.js                         |    63.64 |        0 |        0 |    63.64 |       30,31,34,35 |
  webhooks.js                           |    13.04 |        0 |        0 |    13.04 |... 59,60,61,70,73 |
 server/lib/backyourstack               |       12 |        0 |        0 |     12.5 |                   |
  dispatcher.js                         |       12 |        0 |        0 |     12.5 |... 64,166,176,177 |
 server/lib/cache                       |    29.17 |      2.7 |    14.81 |    31.11 |                   |
  index.js                              |    35.06 |     5.26 |     38.1 |    35.06 |... 24,126,131,135 |
  memcache.js                           |    20.83 |        0 |        0 |    22.73 |... 23,24,26,27,28 |
  memory.js                             |       20 |      100 |        0 |       30 |    4,5,6,7,8,9,10 |
  redis.js                              |       25 |        0 |        0 |    26.92 |... 30,31,32,33,35 |
 server/middleware                      |    16.18 |        0 |     8.82 |    16.87 |                   |
  cache.js                              |    20.51 |        0 |        0 |    20.51 |... 65,66,67,69,71 |
  error_handler.js                      |    17.95 |        0 |        0 |    19.44 |... 71,76,79,80,82 |
  params.js                             |     9.26 |        0 |        0 |     9.62 |... 30,132,133,134 |
  required_param.js                     |    16.67 |        0 |    33.33 |    18.18 |... 45,46,47,48,51 |
  sanitizer.js                          |    23.53 |        0 |       25 |    23.53 |... 19,20,21,22,25 |
 server/middleware/security             |     14.5 |        0 |     2.78 |    15.51 |                   |
  auth.js                               |     9.89 |        0 |        0 |    11.11 |... 80,186,196,203 |
  authentication.js                     |    18.35 |        0 |     5.26 |    18.87 |... 33,235,239,244 |
 server/models                          |    25.22 |     0.76 |    12.89 |     26.8 |                   |
  Activity.js                           |       80 |      100 |       50 |       80 |                21 |
  Application.js                        |    45.45 |        0 |    33.33 |    45.45 | 74,88,89,93,94,99 |
  Collective.js                         |    14.94 |        0 |        9 |    16.03 |... 2398,2402,2405 |
  Comment.js                            |    53.49 |        0 |    26.67 |    54.76 |... 88,192,197,201 |
  ConnectedAccount.js                   |       80 |      100 |       50 |       80 |             48,58 |
  DataTypes.js                          |    33.33 |        0 |       50 |    33.33 |             12,13 |
  Expense.js                            |    28.79 |        0 |    21.43 |    29.23 |... 86,289,290,293 |
  LegalDocument.js                      |    66.67 |        0 |       50 |    66.67 |... 75,87,89,93,95 |
  Member.js                             |     37.5 |        0 |    33.33 |       50 |... 35,136,137,138 |
  Notification.js                       |    23.29 |        0 |    14.81 |    25.76 |... 73,174,176,188 |
  Order.js                              |    28.79 |        0 |     4.35 |    31.15 |... 91,293,294,296 |
  PaymentMethod.js                      |    18.52 |        0 |    17.39 |     18.8 |... 25,528,529,531 |
  RequiredLegalDocument.js              |      100 |      100 |      100 |      100 |                   |
  Session.js                            |      100 |      100 |      100 |      100 |                   |
  Subscription.js                       |       60 |      100 |    33.33 |       60 | 56,57,59,63,64,66 |
  Tier.js                               |    21.28 |        0 |     3.45 |    23.81 |... 67,368,369,370 |
  Transaction.js                        |    20.59 |        0 |     6.45 |    22.05 |... 05,506,508,511 |
  Update.js                             |    34.83 |        0 |    19.35 |    37.35 |... 56,360,361,363 |
  User.js                               |    19.46 |        0 |     3.64 |    20.93 |... 17,518,519,521 |
  index.js                              |    91.14 |    44.44 |       60 |    91.03 |... 27,28,29,33,34 |
 server/paymentProviders                |      100 |      100 |      100 |      100 |                   |
  index.js                              |      100 |      100 |      100 |      100 |                   |
 server/paymentProviders/opencollective |    12.54 |        0 |     5.56 |    12.73 |                   |
  collective.js                         |       26 |        0 |    14.29 |    26.53 |... 30,132,148,150 |
  index.js                              |       50 |        0 |        0 |       50 |    10,12,14,16,19 |
  manual.js                             |       30 |        0 |       25 |       30 |... 42,58,59,68,69 |
  prepaid.js                            |    14.71 |        0 |        0 |    14.71 |... 12,114,119,122 |
  virtualcard.js                        |     5.63 |        0 |        0 |     5.74 |... 37,538,543,546 |
 server/paymentProviders/paypal         |    22.77 |        0 |       18 |    23.47 |                   |
  adaptive.js                           |    28.21 |        0 |    45.45 |    28.21 |... 08,110,111,116 |
  adaptiveGateway.js                    |    35.48 |        0 |        0 |    39.29 |... 43,45,46,48,57 |
  index.js                              |    24.24 |        0 |    16.67 |    24.62 |... 05,206,210,214 |
  payment.js                            |    12.12 |        0 |        0 |     12.5 |... 52,153,154,155 |
 server/paymentProviders/stripe         |    15.27 |        0 |    21.05 |    15.66 |                   |
  creditcard.js                         |     12.3 |        0 |    36.36 |     12.3 |... 32,335,346,354 |
  index.js                              |    19.75 |        0 |        0 |    21.05 |... 88,189,193,195 |
----------------------------------------|----------|----------|----------|----------|-------------------|
